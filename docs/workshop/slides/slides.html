<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <title>A practical guide to SAE – Small Area Population Estimation  A practical guide</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-9da704293d5cc99c773f4fd67dbcdb9e.css">
  <link rel="stylesheet" href="style.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Small Area Population Estimation<br> <span style="font-size:.5em; font-weight: 500">A practical guide</span></h1>
  <p class="subtitle"><br><span style="color:#525252; font-size:1.0em;">British Society for Population Studies 2025 Conference</span></p>

<div class="quarto-title-authors">
</div>

</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="about-us" class="slide level2">
<h2>About us</h2>
<div class="columns">
<div class="column" style="width:49%;">
<p><img data-src="Figures/Adam.jpg"></p>
</div><div class="column" style="width:49%;">
<p><img data-src="Figures/Clara.jpg"></p>
</div></div>
</section>
<section id="about-track-uk" class="slide level2">
<h2>About TRACK-UK</h2>
<div style="font-size: 80%;">
<ul>
<li class="fragment"><p>This workshop is part of a wider project we are working at at UCL, together with Arup and the Alan Turing Institute.</p></li>
<li class="fragment"><p>The project is called TRACK-UK, and funded by the ESRC.</p></li>
<li class="fragment"><p>The project was inspired by the fact that we usually have limited understanding of what happens at small area level in terms of mobility, travel emissions, energy use, or housing quality.</p></li>
<li class="fragment"><p>There is a wide range of existing surveys (NTS, English Housing Survey), but they are usually designed to be used at regional or national scale. It is not easy to use this data to produce neighbourhood or small area estimates (OA, MSOA, LSOA).</p></li>
<li class="fragment"><p>As part of the project, we have had to learn about these methods, so we take this workshop as an opportunity to share what we have learnt with others!</p></li>
</ul>
</div>
</section>
<section id="about-this-workshop" class="slide level2">
<h2>About this workshop</h2>
<ul>
<li><p>The workshop is structured in two parts:</p>
<ul>
<li><p><strong>Theoretical presentation:</strong> We will learn about small area estimation methods from a theoretical perspective, providing an intuitive overview on these methods (9:00 - 9:45)</p></li>
<li><p><strong>Practical</strong>: Hands-on session in <code>R</code> where we will see how to apply all these concepts to real data (10:00 - 10:45)</p></li>
</ul></li>
</ul>
</section>
<section class="slide level2">


<img data-src="https://t3.ftcdn.net/jpg/04/87/13/32/360_F_487133202_AoYev86tqkqK6IsRjnuFWWsTbPDJtqJa.jpg" class="quarto-figure quarto-figure-center r-stretch" width="350"><aside class="notes">
<ul>
<li><p>I have very recently started learning about these methods, so I am still very new to all of this.</p></li>
<li><p>These methods have been applied in other disciplines for quite a long time (epidemiology, health), but in the context of urban analytics, we haven’t widely embraced them. So this is an opportunity to learn a bit more about a very interesting method for us Geography or spatial analysts.</p></li>
<li><p>We will be talking about some relatively complex statistical concepts with which we might not be very familiar with, but are important to understand what lays behind small area estimation.</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="expected-takeaways" class="slide level2">
<h2>Expected takeaways</h2>
<div>
<ul>
<li class="fragment">Understand what Small Area Estimation is and why it can be useful in the context of Urban Analytics.</li>
<li class="fragment">Get familiar with the main types of SAE methods – direct estimators, area-level models, unit-level models, and how they differ in terms of data and complexity.</li>
<li class="fragment">Learn how model-based methods can help us improve our estimates by incorporating auxiliary information.</li>
<li class="fragment">Gain hands-on experience in <code>R</code> applying these methods to real data.</li>
</ul>
</div>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="background" class="title-slide slide level1 center">
<h1>Background</h1>

</section>
<section id="sae-in-the-wild" class="slide level2">
<h2>SAE in the wild</h2>

<img data-src="Figures/WB_poverty_map.png" width="4000" class="r-stretch quarto-figure-center"><p class="caption"><span style="font-size:80%;">Source: World Bank.</span></p></section>
<section id="sae-in-the-wild-1" class="slide level2">
<h2>SAE in the wild</h2>

<img data-src="Figures/housing-prices.jpg" width="4000" class="r-stretch quarto-figure-center"><p class="caption"><span style="font-size:65%;">Source: Bennett, J. E., Rashid, T., Zolfaghari, A., Doyle, Y., Suel, E., Pearson-Stuttard, J., &amp; Ezzati, M. (2023). Changes in life expectancy and house prices in London from 2002 to 2019. <em>The Lancet Regional Health–Europe</em>, 27.</span></p><aside class="notes">
<ul>
<li><p>In other fields, like epidemiology or health, we see maps like this, where metrics are provided at very high spatial resolution level.</p></li>
<li><p>These maps are part of a paper that evaluated the link between housing prices and life expectancy in London between 2002 and 2019 for all London’s LSOAs.</p></li>
<li><p>Such granular outputs allow for more nuanced understanding of inequalities.</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="sae-in-the-wild-2" class="slide level2">
<h2>SAE in the wild</h2>

<img data-src="Figures/ONS_income_SAE.png" width="4000" class="r-stretch quarto-figure-center"><p class="caption"><span style="font-size:80%;">Source: ONS.</span></p><aside class="notes">
<ul>
<li><p>Official institutions like the Office for National Statistics also use these methods to produce very granular statistics.</p></li>
<li><p>This other map shows the estimates that the Office for National Statistics produces for income at postcode level.</p></li>
<li><p>We believe there is a lot of potential for using these methods within our community, adn would like to use this workshop to spread the word and share what we’ve learnt about them so far.</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="clearing-up-the-confusion" class="slide level2">
<h2>Clearing up the confusion</h2>
<div class="custom-grid-stacked">

  <div class="square-row">
    <div class="rectangle rect1" onclick="toggleText(this)">
      <div class="title">Dasymetric population</div>
      <div class="content">
           <strong>Dasymetric mapping</strong> is used to disaggregate coarse resolution population estimates (e.g. census) to produce a finer resolution estimate of a population.
      </div>
    </div>

    <div class="rectangle rect2" onclick="toggleText(this)">
      <div class="title">Synthetic Population</div>
      <div class="content">
        <strong>Synthetic populations</strong> use statistical processes to simulate individual-level data that match known population totals and distributions from sources like census.
      </div>
    </div>
  </div>

  <div class="square-row center">
    <div class="rectangle rect3" onclick="toggleText(this)">
      <div class="title">Small Area Estimation</div>
      <div class="content">
        <strong>Small Area Estimation</strong> is a a statistical methodology that uses models to produce reliable estimates for areas where survey samples are too small or even zero.
      </div>
    </div>
  </div>

</div>

<style>
* {
  font-family: Arial, sans-serif;
}

.custom-grid-stacked {
  display: flex;
  flex-direction: column;
  gap: 30px;
  align-items: center;
}

.square-row {
  display: flex;
  gap: 40px;
  justify-content: center;
}

.square-row.center {
  justify-content: center;
}

.rectangle {
  width: 360px;
  height: 200px;
  border-radius: 12px;
  box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
  padding: 20px;
  cursor: pointer;
  text-align: center;
  position: relative;
  transition: background-color 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  overflow: hidden;
  color: #000;
}

.rect1 {
  background-color: #cad2c5;
}

.rect2 {
  background-color: #84a98c;
}

.rect3 {
  background-color: #52796f;
  color: #fff;
}

.rectangle:hover {
  filter: brightness(1.05);
}

.rectangle .title {
  font-size: 1.2em;
  font-weight: bold;
  transition: opacity 0.3s ease;
}

.rectangle .content {
  display: none;
  font-size: 0.65em;
  font-weight: normal;
  text-align: left;
  line-height: 1.25em;
}

.rectangle.active .title {
  display: none;
}

.rectangle.active .content {
  display: block;
}
</style>

<script>
function toggleText(el) {
  el.classList.toggle('active');
}
</script>


</section>
<section class="slide level2">

</section></section>
<section>
<section id="small-area-estimation-overview" class="title-slide slide level1 center">
<h1>Small Area Estimation Overview</h1>

</section>
<section id="small-area-estimation-overview-1" class="slide level2">
<h2>Small Area Estimation Overview</h2>
<blockquote>
<p>Small Area Estimation (SAE) is a statistical methodology that allows us to <strong>improve the precision</strong> of our estimates when we work with survey data for which <strong>sample sizes</strong> are limited or even zero.</p>
</blockquote>
<aside class="notes">
<ul>
<li><p>The reason we sometimes we don’t have data is because these surveys are designed to aggregate the data at national or regional levle, but not for small areas (like neighbourhoods).</p></li>
<li><p>In urban Analitics we are very interested in this more granular estimates, rather than national or regional estimates.</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="small-area-estimation-overview-2" class="slide level2">
<h2>Small Area Estimation Overview</h2>
<ul>
<li>Why are sample sizes <strong>too small</strong>?
<ul>
<li>Surveys are designed for specific levels of aggregation.</li>
<li>For instance, the NTS is designed for national-level and regional-level aggregation.</li>
<li>If we want to aggregate at a higher spatial resolution, sample sizes might be too small or even zero.</li>
</ul></li>
</ul>
</section>
<section id="small-area-estimation-overview-3" class="slide level2">
<h2>Small Area Estimation Overview</h2>

<img data-src="slides_files/figure-revealjs/unnamed-chunk-1-1.png" width="960" class="r-stretch"><aside class="notes">
<ul>
<li>Survey data is usually designed to be used at certain aggregation levels.</li>
<li>Therefore, the way samples are collected are meant to support the level of aggregation in the survey design.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="small-area-estimation-overview-4" class="slide level2">
<h2>Small Area Estimation Overview</h2>

<img data-src="slides_files/figure-revealjs/unnamed-chunk-2-1.png" width="960" class="r-stretch"><aside class="notes">
<ul>
<li>This can be problematic when we want to aggregate the data at a level that is lower than the survey recommended aggregation level.</li>
<li>For instance, the NTS is not designed to produce robust data below regional level.</li>
<li>If we want to aggregate at a higher spatial resolution than recommended, we might end up with areas or domains for which sampled observations are very small or even zero.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="small-area-estimation-overview-5" class="slide level2">
<h2>Small Area Estimation Overview</h2>

<img data-src="slides_files/figure-revealjs/unnamed-chunk-3-1.png" width="960" class="r-stretch"><aside class="notes">
<ul>
<li>In the example we will work with during the practical, we will use a dummy survey data sample for which some areas have no observations.</li>
<li>We will see how this can be problematic when using certain small area estimation methods.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="small-area-estimation-overview-6" class="slide level2">
<h2>Small Area Estimation Overview</h2>
<blockquote>
<p>SAE methods help us solve this issue by using <u><strong>models</strong></u> that include additional information (<u><strong>auxiliary data</strong></u>) in the form of covariates. This models better explain the variation in our data, and produce more <u><strong>reliable estimates</strong></u>.</p>
</blockquote>
</section></section>
<section>
<section id="sae-methods" class="title-slide slide level1 center">
<h1>SAE methods</h1>

</section>
<section id="sae-methods-overview" class="slide level2">
<h2>SAE methods overview</h2>
<div>
<ul>
<li class="fragment"><p>Today we will talk about the three main small area estimation methodologies: <strong>direct estimators, area-level models, and unit-level models</strong>.</p></li>
<li class="fragment"><p>We can think of them as increasingly complex methods that will help us improving our estimates.</p></li>
<li class="fragment"><p>As complexity increases, our estimates become more accurate. However, this also means that the data and computational requirements of the models also increase.</p></li>
</ul>
</div>
</section>
<section id="sae-methods-overview-1" class="slide level2">
<h2>SAE methods overview</h2>

<img data-src="Figures/simple_diagram_methods.png" class="quarto-figure quarto-figure-center r-stretch" width="2000"><aside class="notes">
<ul>
<li><p>When we talk about precision we talk about the reliability or stability of an estimate for a small area. It reflects how much uncertainty we or variability is associated with that estimate.</p></li>
<li><p>You can think of it as a confidence interval – as your model’s precision improves, your confidence interval narrows.</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="sae-methods-overview-2" class="slide level2">
<h2>SAE methods overview</h2>

<img data-src="Figures/SAE_methods.jpg" class="quarto-figure quarto-figure-center r-stretch"><aside class="notes">
<ul>
<li>The methods we will learn about today are part of a wider family of SAE methods. However, we will focus on these three for the sake of time.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="our-example" class="slide level2">
<h2>Our example</h2>
<div>
<ul>
<li class="fragment">Example: Estimating income for Austrian districts.</li>
<li class="fragment">We are interested in calculating the income levels of the 94 Austrian districts using SAE methods.</li>
<li class="fragment">We have a survey with individual records at District level.</li>
<li class="fragment">For some areas we have very limited observations and for others we have no observations at all.</li>
</ul>
</div>
</section>
<section id="our-example-1" class="slide level2">
<h2>Our example</h2>

<img data-src="slides_files/figure-revealjs/unnamed-chunk-4-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="direct-estimation-methods" class="title-slide slide level1 center">
<h1>Direct estimation methods</h1>

</section>
<section id="direct-estimation-methods-1" class="slide level2">
<h2>Direct estimation methods</h2>
<div style="font-size: 90%;">
<ul>
<li class="fragment">This is the simplest approach to small area estimation.</li>
<li class="fragment">Intuitively, the direct estimator calculates the mean of the survey variable of interest for each area.</li>
<li class="fragment"><em>Example: We take the individual incomes and calculate the average for each district.</em></li>
</ul>
</div>
</section>
<section id="direct-estimation-methods-2" class="slide level2">
<h2>Direct estimation methods</h2>
<ul>
<li>In SAE, this mathematical formulation is known as the <strong>Horvitz-Thompson</strong> estimator.</li>
</ul>
<div class="fragment fade-in" style="font-size: 90%;">
<p><span class="math display">\[
\hat{\bar{Y}_d} = \frac{1}{N_d} \sum_{i \in s_d} {w_{di}} Y_{di}
\]</span></p>
<p>where <span class="math inline">\(\hat{\bar{Y}_d}\)</span> is our estimate for area <span class="math inline">\(d\)</span>; <span class="math inline">\(N_d\)</span> is the total population of domain <span class="math inline">\(d\)</span>, <span class="math inline">\(Y_{di}\)</span> is the observed value for individual <span class="math inline">\(i\)</span> in domain <span class="math inline">\(d\)</span>; and <span class="math inline">\(w_{di}\)</span> is the <strong>sampling weight</strong> of observation <span class="math inline">\(i\)</span> in domain <span class="math inline">\(d\)</span>.</p>
</div>
</section>
<section id="a-quick-note-on-survey-sampling" class="slide level2">
<h2>A quick note on survey sampling</h2>
<div style="font-size: 80%;">
<ul>
<li class="fragment"><p>When a survey is run, the survey design ensures that it is as representative as possible of the full population –i.e.&nbsp;all groups in the population are included in the survey, in a proportion that follows that of the total population.</p></li>
<li class="fragment"><p>There is usually documentation accompanying the survey data explaining the details on how the survey sampling was done.</p></li>
<li class="fragment"><p>As a result, survey data often comes with <strong>sampling weights</strong>, which represent the probability of each observation included in the sample.</p></li>
<li class="fragment"><p>Additionally, the survey can contain more sophisticated attributes, that account for different subgroups within the population –this is known as <strong>stratification</strong>– or account for sampling with or without replacement.</p></li>
</ul>
</div>
</section>
<section id="a-quick-note-on-survey-sampling-1" class="slide level2">
<h2>A quick note on survey sampling</h2>

<img data-src="Figures/sampling.png" class="r-stretch"></section>
<section id="direct-estimation-methods-3" class="slide level2">
<h2>Direct estimation methods</h2>
<ul>
<li><strong>What happens if we have zero sample sizes?</strong> The direct estimator is a <em>fancy</em> mean. Therefore, if there are no observations for an area, we cannot estimate the value of our target variable.</li>
</ul>

<img data-src="Figures/direct_results.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="direct-estimation-methods-4" class="slide level2">
<h2>Direct estimation methods</h2>
<div style="font-size: 80%;">
<ul>
<li class="fragment">Additionally, for areas with small sample sizes, our estimates might be unreliable.</li>
<li class="fragment">What does that mean?
<ul>
<li class="fragment">Example: You want to estimate the mean income of a region, and you randomly sample 2 individuals to draw your estimates (very small sample!). Turns out that those two individuals are the richest ones in the area – You might think that the area is very wealthy, but you just sampled the outliers! <strong>Your estimates will be biased.</strong></li>
</ul></li>
<li class="fragment">How do you solve this problem? You can use more sophisticated methods <strong>(model-based SAE methods)</strong> which incorporate additional information allowing you to make <em>better informed</em> guesses about your target variable.</li>
</ul>
</div>
</section>
<section id="direct-methods-advantages-and-limitations" class="slide level2">
<h2>Direct methods: Advantages and limitations</h2>
<div style="font-size: 80%;">
<h3 id="advantages">Advantages</h3>
<ul>
<li class="fragment">The direct estimation method works well when the sample has good coverage across all areas you are interested in.</li>
<li class="fragment">It does not rely on external data, as it only uses observed data from the survey.</li>
<li class="fragment">It is intuitive, and easy to interpret.</li>
</ul>
<h3 id="limitations">Limitations</h3>
<ul>
<li class="fragment">Unreliable for areas where you have small samples – estimates can be very “noisy” (it is not very precise).</li>
<li class="fragment">Not available for an area of interest for which we have no respondents.</li>
</ul>
</div>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="model-based-estimation-methods" class="title-slide slide level1 center">
<h1>Model-based estimation methods</h1>

</section>
<section id="model-based-estimation-methods-1" class="slide level2">
<h2>Model-based estimation methods</h2>
<div style="font-size: 80%;">
<ul>
<li class="fragment"><p>Direct methods are only reliable under large enough samples. However, this is not usually the case when we work with real survey data and small areas.</p></li>
<li class="fragment"><p>Furthermore, we usually have access to additional sources of information, not just survey data –e.g.&nbsp;census data, administrative data– which can tell us more about the target variable.</p></li>
<li class="fragment"><p>We can therefore take advantage of this extra information and improve our estimates by <strong>“borrowing strength”</strong> from these other sources.</p></li>
<li class="fragment"><p><strong>Model-based methods</strong> allow us to incorporate <strong>auxiliary information</strong> to improve our estimates.</p></li>
</ul>
</div>
</section>
<section id="section" class="slide level2">
<h2></h2>
</section>
<section id="model-based-estimation-methods-2" class="slide level2">
<h2>Model-based estimation methods</h2>
<div>
<ul>
<li class="fragment">Imagine you have information about number of vehicles per household at district level, and you want to estimate the district’s income levels.</li>
<li class="fragment">Number of vehicles per household is a good indicator of income levels.</li>
<li class="fragment">Model-based methods allow you to incorporate this <em>auxiliary information</em> to your estimator in order to improve your predictions on income levels.</li>
</ul>
</div>
</section>
<section id="model-based-estimation-methods-3" class="slide level2">
<h2>Model-based estimation methods</h2>
<div style="font-size: 90%;">
<ul>
<li class="fragment"><p>The type of data we incorporate into our analysis will determine the type of model-based estimation method we will use.</p></li>
<li class="fragment"><p>Model-based methods are divided into <strong>area-level models</strong>, and <strong>unit-level models</strong>:</p>
<ul>
<li class="fragment"><strong>Area-level models</strong> use aggregated auxiliary data at domain level (e.g.&nbsp;average house prices, age distribution)</li>
<li class="fragment"><strong>Unit-level models</strong> also include individual (unit)-level data from surveys (e.g.&nbsp;paid rent, individual age).</li>
</ul></li>
</ul>
</div>
</section></section>
<section>
<section id="area-level-models" class="title-slide slide level1 center">
<h1>Area-level models</h1>

</section>
<section id="area-level-models-1" class="slide level2">
<h2>Area-level models</h2>
<div style="font-size: 90%;">
<ul>
<li class="fragment"><p>Area-level models only use covariates at domain level.</p></li>
<li class="fragment"><p>Formally, we estimate them using the <strong>Fay-Herriot</strong> model.</p></li>
<li class="fragment"><p>The Fay-Herriot model uses a two-step approach where we first calculate the direct estimator, and then model the outcomes using the auxiliary information.</p></li>
</ul>
</div>
</section>
<section id="area-level-models-2" class="slide level2">
<h2>Area-level models</h2>
<div class="fragment" style="font-size: 80%;">
<ul>
<li><p>First, the <strong>sampling model</strong> models the direct estimator.</p>
<p><span class="math display">\[
\hat{\theta}_d^{DIR} = \theta_d + \epsilon_d
\]</span></p></li>
</ul>
<p>where <span class="math inline">\(\hat{\theta}_d^{DIR}\)</span> is the direct estimate for area <span class="math inline">\(d\)</span>,formed by the true value <span class="math inline">\(\theta_d\)</span> plus the sampling error <span class="math inline">\(\epsilon_d\)</span>, which reflects the sampling error.</p>
<div style="font-size: 100%;">
<ul>
<li class="fragment"><p>The sampling model establishes the relationship between the what we observe in the survey and the true values of the estimator.</p></li>
<li class="fragment"><p>What it says, intuitively, is that each direct estimate is the true value plus some noise produced by using a sample, instead of the full population.</p></li>
<li class="fragment"><p>The level of noise depends on the sample size: smaller samples lead to more noise.</p></li>
</ul>
</div>
</div>
</section>
<section id="area-level-models-3" class="slide level2">
<h2>Area-level models</h2>
<div class="fragment" style="font-size: 80%;">
<ul>
<li class="fragment"><p>Next, the <strong>linking model</strong> <em>links</em> the true mean with the auxiliary information. This is the bit that lets us <em>borrow strength</em> from additional information.</p>
<p><span class="math display">\[
  \theta_d = \mathbf{x}_d^T \boldsymbol{\beta} + u_d, \quad u_d \sim_{\text{ind}} N(0, \sigma_u^2), \quad d = 1, \ldots, M
  \]</span></p>
<p>where <span class="math inline">\(\theta_i\)</span> is the true value of the parameter; <span class="math inline">\(\mathbf{x}_d^T\)</span> are the covariates for area <span class="math inline">\(d\)</span>, with their respective <span class="math inline">\(\beta\)</span> coefficients (the fixed effects), and <span class="math inline">\(u_d\)</span> is the area-level random effect, capturing the unexplained differences between areas.</p></li>
<li class="fragment"><p>What this part of the model says, intuitively, is that the true area value is not just random noise, it can be predicted through known area-level data (<span class="math inline">\(\mathbf{x}_d^T\)</span>).</p></li>
<li class="fragment"><p>But we always introduce some errors because of everything we cannot measure (<span class="math inline">\(u_d\)</span>).</p></li>
<li class="fragment"><p>Together (<span class="math inline">\(\mathbf{x}_d^T \boldsymbol{\beta} + u_d\)</span>) we get a better-informed <em>guess</em> of the true value of our estimator.</p></li>
</ul>
</div>
</section>
<section id="area-level-models-4" class="slide level2">
<h2>Area-level models</h2>
<ul>
<li><p>Together, we obtain the following equation:</p>
<p><span class="math display">\[
   \hat{\theta}_d^{DIR} = \theta_d + \mathbf{x}_d^T \boldsymbol{\beta} + u_d + \epsilon_d, \quad u_d \sim_{\text{ind}} N(0, \sigma_u^2), \quad d = 1, \ldots, M
  \]</span></p></li>
</ul>
</section>
<section id="area-level-models-5" class="slide level2">
<h2>Area-level models</h2>
<div class="fragment" style="font-size: 75%;">
<ul>
<li>The Fay-Herriot model produces its estimates using what is known as the Empirical Best Linear Unbiased Predictor (EBLUP), which is formulated as:</li>
</ul>
<p><span class="math display">\[
\theta_d^{FH} = \gamma_d \hat{\theta_d}^{DIR} + (1 - \gamma_d)(\mathbf{x}_d^T \boldsymbol{\hat{\beta}})
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
\gamma_d = \frac{\sigma_u^2}{\sigma_u^2 + V_d}
\]</span></p>
<p>with <span class="math inline">\(V_d\)</span> being the variance of the direct estimator, which we know.</p>
</div>
</section>
<section id="area-level-models-6" class="slide level2">
<h2>Area-level models</h2>
<div>
<ul>
<li class="fragment"><p>What this means is that the Fay-Herriot model is a weighted average of the direct estimator and the model estimate.</p></li>
<li class="fragment"><p>The FH estimator will rely more on the direct estimator when sample sizes are large.</p></li>
<li class="fragment"><p>The FH estimator will rely more on the model estimates when sample sizes are small.</p></li>
</ul>
</div>
</section>
<section id="spatial-area-level-models" class="slide level2">
<h2>Spatial area-level models</h2>
<div style="font-size: 60%;">
<ul>
<li class="fragment"><p>The basic Fay-Herriot model assumes that the area-level effects (<span class="math inline">\(u_d\)</span>) are independent and identically distributed.</p></li>
<li class="fragment"><p>What this means is that what happens in one area is unrelated to what is happening in other areas. In our example, this would mean that the income in one places is not related to income anywhere else.</p></li>
<li class="fragment"><p>In reality, we know that this is usually not true: neighbouring areas tend to look alike (Tobler’s First Law of Geography).</p></li>
<li class="fragment"><p>We can therefore include space in our models by adding a spatial effect. This will ensure that our model understands that areas that are closer will have estimates that are more similar than those of areas further away.</p></li>
</ul>
<div class="fragment" style="font-size: 100%;">
<p><span class="math display">\[
u = \rho_1 Wu + \epsilon
\]</span></p>
<p>where <span class="math inline">\(W\)</span> is the adjacency matrix which tells us which districts are neighbours; <span class="math inline">\(\rho_1\)</span> is the spatial autorregression parameter, a single value between -1 and 1 that tells us how strong the relationship between neighbours is; <span class="math inline">\(u_d\)</span> is the area of interest; and <span class="math inline">\(\epsilon\)</span> is the error term.</p>
</div>
</div>
</section>
<section id="area-level-models-the-intercept-only-model" class="slide level2">
<h2>Area-level models – The intercept-only model</h2>
<div style="font-size: 75%;">
<ul>
<li class="fragment">What happens if we do not have access to area-level auxiliary information?</li>
<li class="fragment">Do not worry! We can still use area-level modelling.</li>
<li class="fragment">In this case, we will use the intercept-only model, which allows us to generate estimates based on a combination of the direct estimates for each domain, and the global average.</li>
<li class="fragment">The weight of each component will depend on the variance of the sampling error:
<ul>
<li class="fragment">For areas with large samples, the direct estimator will have more weight than the global average.</li>
<li class="fragment">For areas with small samples, the global average will have more weight.</li>
<li class="fragment">For out-of-sample areas, the global mean will be assigned as the <em>best guess</em></li>
</ul></li>
</ul>
</div>
</section>
<section id="area-level-models-the-intercept-only-model-1" class="slide level2">
<h2>Area-level models – The intercept-only model</h2>
<ul>
<li>In this case, the equation of the intercept-only model is:</li>
</ul>
<p><span class="math display">\[
    \theta_d = \beta_0 + u_d, \quad u_d \sim_{\text{ind}} N(0, \sigma_u^2), \quad d = 1, \ldots, M
\]</span></p>
<p>where <span class="math inline">\(\beta_0\)</span> is the global average, and <span class="math inline">\(u_d\)</span> represents the area-level random effects.</p>
</section>
<section id="area-level-vs-direct-estimator" class="slide level2">
<h2>Area-level vs Direct estimator</h2>
<div style="font-size: 90%;">
<ul>
<li class="fragment"><p>The area-level model can calculate estimates for out-of-sample domains, although their accuracy will depend on how good the model is at explaining uncertainty through the auxiliary variables.</p></li>
<li class="fragment"><p>In general, when comparing the estimates of the direct estimator and area-level model, we observe how the uncertainty around our estimates decreases with the latter method.</p></li>
<li class="fragment"><p>We will further explore this in the practical.</p></li>
</ul>
</div>
</section>
<section id="area-level-vs-direct-estimator-1" class="slide level2">
<h2>Area-level vs Direct estimator</h2>

<img data-src="Figures/fay-herriot_estimates.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="area-level-vs-direct-estimator-2" class="slide level2">
<h2>Area-level vs Direct estimator</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p><img data-src="Figures/direct_estimates_uncertainty.png"></p>
</div><div class="column" style="width:54%;">
<p><img data-src="Figures/area_level_estimates_uncertainty.png"></p>
</div></div>
</section>
<section id="area-level-models-advantages-and-limitations" class="slide level2">
<h2>Area-level models: Advantages and limitations</h2>
<div style="font-size: 80%;">
<h3 id="advantages-1">Advantages</h3>
<ul>
<li class="fragment">The main advantage of using an area-level model is that we increase the precision of our estimates by adding auxiliary information at area level.</li>
<li class="fragment">Additionally, this allows us to obtain predictions for out-of-sample domains, even when no auxiliary information is available.</li>
</ul>
<h3 id="limitations-1">Limitations</h3>
<ul>
<li class="fragment">These models require access to area-level data, and are not as straightforward to interpret as direct methods.</li>
</ul>
</div>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="unit-level-models" class="title-slide slide level1 center">
<h1>Unit-level models</h1>

</section>
<section id="unit-level-models-1" class="slide level2">
<h2>Unit-level models</h2>
<div style="font-size: 65%;">
<ul>
<li class="fragment"><p>Unit-level models are the most complex type of SAE method we will talk about today.</p></li>
<li class="fragment"><p>Unit-level models uses <strong>individual responses</strong> from survey combined with covariates available for the <strong>whole population</strong>, available through synthetic populations or census microdata.</p></li>
<li class="fragment"><p>In general, they allow for producing more precise estimates than direct estimators and area-level models.</p></li>
<li class="fragment"><p>Similarly to area-level models, unit-level models also produce estimates for out-of-sample domains (assuming we have access to unit-level auxiliary data).</p></li>
</ul>
</div>
</section>
<section id="unit-level-models-2" class="slide level2">
<h2>Unit-level models</h2>
<ul>
<li><p>The most basic unit-level models are known as <strong>nested error</strong> or <strong>Battese, Harter, and Fuller</strong> models.</p></li>
<li><p>These type of models are called <em>nested</em> because they include both area-level and unit-level random effects:</p></li>
</ul>
<div class="fragment" style="font-size: 65%;">
<p><span class="math display">\[
  y_{di} = \mathbf{x}_{di}^T \beta + u_d + \epsilon_{di} , \quad u_d \sim_{\text{ind}} N(0, \sigma_u^2), \quad \epsilon_{di} \sim_{\text{ind}} N(0, \sigma_\epsilon^2)
\]</span></p>
<ul>
<li class="fragment"><p>where <span class="math inline">\(y_{di}\)</span> is the unit-level outcome for individual <span class="math inline">\(i\)</span> in area <span class="math inline">\(d\)</span>,<br>
</p></li>
<li class="fragment"><p><span class="math inline">\(\mathbf{x}_{di}^T \beta\)</span> represents the individual-level covariates and their coefficients,<br>
</p></li>
<li class="fragment"><p><span class="math inline">\(u_d\)</span> is the area-level random effect, and<br>
</p></li>
<li class="fragment"><p><span class="math inline">\(\epsilon_{di}\)</span> is the unit-level error term, capturing individual variability within each area.</p></li>
<li class="fragment"><p>This data is then aggregated at any desired spatial resolution.</p></li>
</ul>
</div>
</section>
<section id="unit-level-models-3" class="slide level2">
<h2>Unit-level models</h2>
<div>
<ul>
<li class="fragment">The model is estimated over the survey data, with observed values of <span class="math inline">\(y_{di}\)</span> and <span class="math inline">\(x_{di}\)</span>.</li>
<li class="fragment">It is then applied to the full population, using the microdata or synthetic data available, and used to predict the values of <span class="math inline">\(y_{di}\)</span> for every element of the population.</li>
<li class="fragment">The individual-level values are then aggregated at the desired spatial level.</li>
</ul>
</div>
</section>
<section id="unit-level-models-4" class="slide level2">
<h2>Unit-level models</h2>
<div style="font-size: 75%;">
<ul>
<li class="fragment"><p>The area-level random effect accounts for those attributes of the domain that cannot be explained by the area-level auxiliary variables we include in the model, and contribute to variations in the target variable.</p>
<ul>
<li class="fragment">E.g. Vienna being the capital, and this leading to higher average income levels.</li>
</ul></li>
<li class="fragment"><p>Similarly, the unit-level random effects account for individual-level characteristics that cannot be explained by the unit-level covariates included in the model.</p>
<ul>
<li class="fragment">E.g. A person being the CEO at a bank and earning a very high salary (assuming we do not include occupation as a covariate).</li>
</ul></li>
</ul>
</div>
</section>
<section id="unit-level-models-5" class="slide level2">
<h2>Unit-level models</h2>
<div style="font-size: 70%;">
<ul>
<li class="fragment">The unit-level model can be interpreted as a bottom-up approach to small area estimation.</li>
<li class="fragment">This gives us more flexibility, since the use of individual-level information allows us to aggregate the data at other domain levels without being constrained by the resolution of the area-level of the auxiliary covariates (as opposed to area-level models).</li>
<li class="fragment">The data requirements, however, are much higher for unit-level models: we need access to individual data, which can come from census microdata or synthetic populations. These might not always be available.</li>
</ul>
</div>
</section>
<section id="unit-level-models-advantages-and-limitations" class="slide level2">
<h2>Unit-level models: Advantages and limitations</h2>
<div style="font-size: 70%;">
<h3 id="advantages-2">Advantages</h3>
<ul>
<li class="fragment"><p>Unit-level models are the most precise out of the SAE methods we have learnt about today, assuming data is available.</p></li>
<li class="fragment"><p>Unit-level models constitue a “bottom-up” approach to SAE –they use the most granular available data (unit-level).</p></li>
<li class="fragment"><p>They are very flexible, since they allow for aggregation at any desired geographical level.</p></li>
</ul>
<h3 id="limitations-2">Limitations</h3>
<ul>
<li class="fragment"><p>They require access to population-level auxiliary data at individual level, which may not always be available.</p></li>
<li class="fragment"><p>Estimation is more complex and computationally demanding than area-level models, especially when working with large populations.</p></li>
</ul>
</div>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="summary-and-key-takeaways" class="title-slide slide level1 center">
<h1>Summary and key takeaways</h1>

</section>
<section id="summary-and-key-takeaways-1" class="slide level2">
<h2>Summary and key takeaways</h2>
<div style="font-size: 80%;">
<ul>
<li class="fragment"><p>Small Area Estimation helps us produce reliable estimates in areas where survey data is sparse or missing.</p></li>
<li class="fragment"><p>We explored three SAE approaches:</p>
<ul>
<li class="fragment">Direct estimators: straightforward, but unreliable for small samples.</li>
<li class="fragment">Area-level models: use domain-level covariates to improve estimates.</li>
<li class="fragment">Unit-level models: use individual-level data for even more precision.</li>
</ul></li>
<li class="fragment"><p>Model-based methods “borrow strenght” from auxiliary information (e.g.&nbsp;census data, spatial data), allowing us to reduce noise and fill data gaps.</p></li>
<li class="fragment"><p>Spatial models can improve accuracy furhter by accounting for the spatial autocorrelation of the data.</p></li>
</ul>
</div>
</section>
<section id="qr-code-for-practical" class="slide level2">
<h2>QR code for practical</h2>

<img data-src="Figures/qr-code.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="additional-resources" class="slide level2 smaller scrollable">
<h2>Additional Resources</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-battese1988error" class="csl-entry" role="listitem">
Battese, G. E., Harter, R. M., &amp; Fuller, W. A. (1988). An error-components model for prediction of county crop areas using survey and satellite data. <em>Journal of the American Statistical Association</em>, <em>83</em>(401), 28–36.
</div>
<div id="ref-fay1979estimates" class="csl-entry" role="listitem">
Fay III, R. E., &amp; Herriot, R. A. (1979). Estimates of income for small places: An application of james-stein procedures to census data. <em>Journal of the American Statistical Association</em>, <em>74</em>(366a), 269–277.
</div>
<div id="ref-horvitz1952generalization" class="csl-entry" role="listitem">
Horvitz, D. G., &amp; Thompson, D. J. (1952). A generalization of sampling without replacement from a finite universe. <em>Journal of the American Statistical Association</em>, <em>47</em>(260), 663–685.
</div>
<div id="ref-kreutzmann2019r" class="csl-entry" role="listitem">
Kreutzmann, A.-K., Pannier, S., Rojas-Perilla, N., Schmid, T., Templ, M., &amp; Tzavidis, N. (2019). The r package emdi for estimating and mapping regionally disaggregated indicators. <em>Journal of Statistical Software</em>, <em>91</em>, 1–33.
</div>
<div id="ref-molina2015sae" class="csl-entry" role="listitem">
Molina, I., &amp; Marhuenda, Y. (2015). <em>Sae: An r package for small area estimation</em>.
</div>
<div id="ref-morales2021course" class="csl-entry" role="listitem">
Morales, D., Lefler, M., Pérez, A., &amp; Hobza, T. (2021). <em>A course on small area estimation and mixed models; statistics for social and behavioral sciences</em>. Springer: Berlin/Heidelberg, Germany.
</div>
<div id="ref-parker2019unit" class="csl-entry" role="listitem">
Parker, P. A., Janicki, R., &amp; Holan, S. H. (2019). Unit level modeling of survey data for small area estimation under informative sampling: A comprehensive overview with extensions. <em>arXiv Preprint arXiv:1908.10488</em>.
</div>
<div id="ref-rao2015small" class="csl-entry" role="listitem">
Rao, J. N., &amp; Molina, I. (2015). <em>Small area estimation</em>. John Wiley &amp; Sons.
</div>
<div id="ref-swanwick2022dasymetric" class="csl-entry" role="listitem">
Swanwick, R. H., Read, Q. D., Guinn, S. M., Williamson, M. A., Hondula, K. L., &amp; Elmore, A. J. (2022). Dasymetric population mapping based on US census data and 30-m gridded estimates of impervious surface. <em>Scientific Data</em>, <em>9</em>(1), 523.
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><a href=""></a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>